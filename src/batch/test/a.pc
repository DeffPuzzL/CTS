/**************************************************************************************************
	文 件 名：a.pc
	代码作者：DeffPuzzL
	编写版本：
	创建日期：2016-07-14
	功能描述：demo实现业务模块
 **************************************************************************************************/
#include    "load.h"
#include    "Ibp.h"
#include    "DbsApi.h"
#include    "settle.h"

/**************************************************************************************************
    函 数 名：main
    功能描述：进程监控主模块
    返回说明：
        RC_SUCC         --成功
        RC_FAIL         --失败
 **************************************************************************************************/
int     main(int argc, char *argv[])
{
	long	lQid = 0;
    struct  msqid_ds    stQueue;
    cJSON   *root = NULL;

    root = cJSON_CreateObject();

    child = cJSON_CreateObject();

    array = cJSON_CreateArray();

    cJSON_AddStringToObject(root, "field1", "111");
    cJSON_AddStringToObject(root, "field2", "222");
    cJSON_AddNumberToObject(root, "field3", 333);

    cJSON_AddStringToObject(child, "field4", "411");
    cJSON_AddStringToObject(child, "field5", "511");
    cJSON_AddStringToObject(child, "field6", "611");

    tmp = cJSON_CreateObject();
    cJSON_AddStringToObject(tmp, "one", "aaa");
    cJSON_AddItemToArray(array, tmp);
    tmp = cJSON_CreateObject();
    cJSON_AddStringToObject(tmp, "two", "bbb");
    cJSON_AddItemToArray(array, tmp);



    cJSON_AddItemToObject(root, "child", child);
    cJSON_AddItemToObject(root, "array", array);

    p = cJSON_PrintUnformatted(root);
    cJSON_Delete(root);


	lQid = atol(argv[1]);
	fprintf(stdout, "Qid:%d\n", lQid);
    if(msgctl(lQid, IPC_STAT, &stQueue) <= -1)
    {
        fprintf(stderr, "连接消息队列(%d)失败, err:%s\n", lQid, strerror(errno));
        return RC_FAIL;
    }

	fprintf(stdout, "%d\n", stQueue.msg_qnum);

    return RC_SUCC;
}

/*************************************************************************************************
	code end
**************************************************************************************************/

